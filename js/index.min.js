let modalContainer=document.querySelector(".modal__container");function showModal(e){modalContainer.classList.toggle("hidden"),e.classList.toggle("hidden")}let todoContainer=document.querySelector(".todo__container");localStorage.getItem("elements")&&(todoContainer.innerHTML=localStorage.getItem("elements"));const notesList=document.querySelector(".notes__list");localStorage.getItem("noteList")&&(notesList.innerHTML=localStorage.getItem("noteList"));const eventsList=document.querySelector(".events__list");if(localStorage.getItem("eventList")){eventsList.innerHTML=localStorage.getItem("eventList");let e=document.querySelectorAll(".events__list__item");e.forEach(e=>{setCountDown(e);setInterval(()=>setCountDown(e),1e3)})}let addButton=document.querySelector(".todo__addBtn"),addModal=document.querySelector(".modal__add"),addModalCancel=document.querySelector(".modal__cancel__addbtn");addButton.addEventListener("click",()=>showModal(addModal)),addModalCancel.addEventListener("click",()=>showModal(addModal));let addItemBtn=document.querySelector(".modal__add__addbtn"),titleInput=document.querySelector(".todo__title__input"),descriptionInput=document.querySelector(".todo__comment__input"),mainBlock=document.querySelector(".todo__main__content");const eventCheckbox=document.querySelector(".modal__add__checkbox-input"),todoDateInput=document.querySelector(".modal__add__date");function addItem(){let e=document.createElement("div");e.draggable=!0;let t=new Date,o=t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear();if(e.classList.add("todo__item"),e.innerHTML=`<h4 class="todo__item__header">${titleInput.value}</h4>\n    <div class="todo__item__buttons">\n        <button class="inprogress__button" title="В процессе"></button>\n        <button class="delete__button" title="Удалить"></button>\n        <button class="inmain__button" title="В невыполненные"></button>\n        <button class="indone__button" title="В выполненные"></button>\n    </div>\n    <p class="todo__item__description">${descriptionInput.value}</p>\n    <p class="todo__item__date">${o}</p>\n    <button class="item__show"><span>Показать</span></button>`,eventCheckbox.checked){if(!titleInput.value||!todoDateInput.value)return void alert("Чтобы добавить задачу в событие введите название и выберите дату");createNote(titleInput,todoDateInput)}mainBlock.append(e),showModal(addModal),titleInput.value="",descriptionInput.value="",localStorage.setItem("elements",todoContainer.innerHTML),counters()}addItemBtn.addEventListener("click",addItem);let inprogressBlock=document.querySelector(".todo__inprogress__content"),doneBlock=document.querySelector(".todo__done__content"),trashBlock=document.querySelector(".todo__trash__content"),deleteModal=document.querySelector(".modal__delete"),delCancelBtn=document.querySelector(".modal__delete__cancelbtn");function changeBlock(e,t){let o=e.closest(".todo__item");t.append(o),localStorage.setItem("elements",todoContainer.innerHTML),counters()}delCancelBtn.addEventListener("click",()=>showModal(deleteModal)),todoContainer.addEventListener("click",(function(e){if(e.target.classList.contains("inprogress__button"))changeBlock(e.target,inprogressBlock);else if(e.target.classList.contains("inmain__button"))changeBlock(e.target,mainBlock);else if(e.target.classList.contains("indone__button"))changeBlock(e.target,doneBlock);else if(e.target.classList.contains("delete__button"))if(e.target.closest(".todo__item").parentElement.classList.contains("todo__trash__content")){showModal(deleteModal),document.querySelector(".modal__delete__deletebtn").onclick=function(){e.target.closest(".todo__item").remove(),localStorage.setItem("elements",todoContainer.innerHTML),counters(),showModal(deleteModal)}}else changeBlock(e.target,trashBlock);else e.target.classList.contains("todo__clear")&&(e.target.closest(".todo__block").querySelector(".todo__content").innerHTML="",localStorage.setItem("elements",todoContainer.innerHTML),counters())}));let todoBlocks=document.querySelectorAll(".todo__block");function counters(){todoBlocks.forEach(e=>{let t=e.querySelector(".todo__counter"),o=e.querySelector(".todo__content");t.textContent=o.children.length})}todoBlocks.forEach(e=>{e.addEventListener("dragstart",(function(e){e.target.classList.add("dragnow")})),e.addEventListener("dragend",(function(e){e.target.classList.remove("dragnow")})),e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",(function(t){t.preventDefault();let o=document.querySelector(".dragnow");if(null!=o){e.querySelector(".todo__content").append(o)}counters()}))}),counters();let editModal=document.querySelector(".modal__edit");todoContainer.addEventListener("click",(function(e){if(e.target.classList.contains("item__show")){let t=e.target.closest(".todo__item").querySelector(".todo__item__header").textContent,o=e.target.closest(".todo__item").querySelector(".todo__item__description").textContent;editModal.innerHTML=`\n    <h2>${t}</h2>\n            <p>${o}</p>\n            <div class="modal__edit__buttons">\n                <button type="button" class="modal__edit__editbtn">Редактировать</button>\n                <button type="button" class="modal__cancel__editbtn">Закрыть</button>\n            </div>\n    `,document.querySelector(".modal__cancel__editbtn").addEventListener("click",()=>showModal(editModal)),document.querySelector(".modal__edit__editbtn").onclick=function(){editModal.innerHTML=`\n        <label for="edit__header">Название</label>\n    <input type="text" value="${t}" id="edit__header">\n    <label for="edit__comment">Описание</label>\n            <textarea id="edit__comment">${o}</textarea>\n            <div class="modal__edit__buttons">\n                <button type="button" class="modal__save__editbtn">Сохранить</button>\n                <button type="button" class="modal__cancel__editbtn">Закрыть</button>\n            </div>\n    `,document.querySelector(".modal__cancel__editbtn").addEventListener("click",()=>showModal(editModal));let n=document.getElementById("edit__header"),l=document.getElementById("edit__comment");document.querySelector(".modal__save__editbtn").addEventListener("click",(function(){e.target.closest(".todo__item").querySelector(".todo__item__header").textContent=n.value,e.target.closest(".todo__item").querySelector(".todo__item__description").textContent=l.value,localStorage.setItem("elements",todoContainer.innerHTML),showModal(editModal)}))},showModal(editModal)}}));let aboutBtn=document.querySelector(".about__btn"),aboutModal=document.querySelector(".modal__about"),aboutCloseBtn=document.querySelector(".modal__about__closeBtn");aboutBtn.addEventListener("click",()=>showModal(aboutModal)),aboutCloseBtn.addEventListener("click",()=>showModal(aboutModal));let instructionBtn=document.querySelector(".instruction__btn"),instructionModal=document.querySelector(".modal__instruction"),instructionCloseBtn=document.querySelector(".modal__instruction__closeBtn");instructionBtn.addEventListener("click",()=>showModal(instructionModal)),instructionCloseBtn.addEventListener("click",()=>showModal(instructionModal));let burgerMenu=document.querySelector(".burgermenu"),navMenu=document.querySelector(".header_nav_list"),header=document.querySelector(".header");header.addEventListener("click",(function(e){(e.target.closest(".burgermenu")||e.target.closest(".header_nav_list_item"))&&(burgerMenu.classList.toggle("active"),navMenu.classList.toggle("active"),header.classList.toggle("active"),console.log(e.target))}));let searchBtn=document.querySelector(".todo__searchbutton"),searchInput=document.querySelector(".todo__searchInput"),searchModal=document.querySelector(".modal__search");searchBtn.onclick=function(){let e=document.querySelectorAll(".todo__item"),t=searchModal.innerHTML,o=Array.from(e).filter(e=>e.querySelector(".todo__item__header").textContent.toLocaleLowerCase()==searchInput.value.toLocaleLowerCase()).map(e=>{let t=e.cloneNode(!0);return t.querySelectorAll("button").forEach(e=>e.remove()),t});o.length>0?(showModal(searchModal),searchModal.append(...o)):alert("Ничего не найдено"),document.querySelector(".modal__search__closeBtn").onclick=function(){searchModal.innerHTML=t,showModal(searchModal)}};const calcButtons=document.querySelector(".calc__buttons"),calcScreen=document.querySelector(".calc__input"),calcOutput=document.querySelector(".calc__output"),modalCalc=document.querySelector(".modal__calc");document.addEventListener("click",(function(e){e.target.closest(".calc__open")&&showModal(modalCalc),e.target.closest(".modal__calc__closeBtn")&&showModal(modalCalc)})),calcButtons.addEventListener("click",(function(e){let targetEl=e.target;if(targetEl.closest(".calc__btn")&&(calcScreen.value+=targetEl.value,calcOutput.textContent+=targetEl.value),targetEl.closest(".calc__delall")&&(calcOutput.textContent=calcOutput.textContent.slice(0,-1),calcScreen.value=calcScreen.value.slice(0,-1)),targetEl.closest(".calc__del")&&(calcScreen.value="",calcOutput.textContent=""),targetEl.closest(".calc__funcbtn")){const e=Array.from(document.querySelectorAll(".calc__funcbtn")).map(e=>e.value);let t=calcOutput.textContent[calcOutput.textContent.length-1];if(console.log(e.includes(t)),e.includes(t))calcOutput.textContent=calcOutput.textContent.slice(0,-1),calcOutput.textContent+=targetEl.value,calcScreen.value="";else{if(""==calcOutput.textContent)return;calcOutput.textContent+=targetEl.value,calcScreen.value=""}}if(targetEl.closest(".calc__ebtn")){let calcResult=calcOutput.textContent.replace("%","/100*");calcScreen.value.includes(".")?calcScreen.value=eval(calcResult).toFixed(5):calcScreen.value=eval(calcResult),calcOutput.textContent=calcScreen.value}}));const notes=document.querySelector(".notes"),notesAddBtn=document.querySelector(".notes__creator__newbtn"),notesCreator=document.querySelector(".notes__creator__body"),modalEditor=document.querySelector(".modal__notes-editor");function toggleHidden(e){e.classList.toggle("hidden")}notes.addEventListener("click",(function(e){let t=e.target;if((t.closest(".notes__creator__newbtn")||t.closest(".creator__cancel-btn"))&&(toggleHidden(notesAddBtn),toggleHidden(notesCreator)),t.closest(".creator__save-btn")){const e=document.querySelector(".creator__body__title"),t=document.querySelector(".creator__body__text");let o=document.createElement("li");o.classList.add("notes__list__item"),o.innerHTML=`<h3 class="notes__item__title">${e.value?e.value:"Заметка"}</h3>\n    <p class="notes__item__text">${t.value}</p>\n    <button class="notes__del-btn"></button>\n    `,notesList.append(o),e.value="",t.value="",toggleHidden(notesAddBtn),toggleHidden(notesCreator),localStorage.setItem("noteList",notesList.innerHTML)}if(t.closest(".notes__del-btn")&&(t.closest(".notes__list__item").remove(),localStorage.setItem("noteList",notesList.innerHTML)),t.closest(".notes__list__item")&&!t.closest(".notes__del-btn")){let e=t.closest(".notes__list__item");const o=document.querySelector(".notes-editor__title"),n=document.querySelector(".notes__editor__text"),l=document.querySelector(".notes-editor__savebtn"),c=document.querySelector(".notes-editor__cancelbtn");o.value=e.querySelector(".notes__item__title").textContent,n.value=e.querySelector(".notes__item__text").textContent,showModal(modalEditor),l.onclick=function(){e.querySelector(".notes__item__title").textContent=o.value,e.querySelector(".notes__item__text").textContent=n.value,notesList.prepend(e),localStorage.setItem("noteList",notesList.innerHTML),showModal(modalEditor)},c.onclick=function(){showModal(modalEditor)}}}));const events=document.querySelector(".events"),eventsAddbtn=document.querySelector(".events__creator__newbtn"),eventsCreator=document.querySelector(".events__creator__body"),dateOptions={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"};function createNote(e,t){let o=document.createElement("li");o.classList.add("events__list__item"),o.setAttribute("data-date",new Date(t.value)),o.innerHTML=`<h3 class="events__item__title">${e.value}</h3>\n  <p class="events__item__text">${new Date(t.value).toLocaleDateString("ru-RU",dateOptions)}</p>\n  <p class="events__item__countdown"></p>\n  <button class="events__del-btn"></button>`,setCountDown(o);setInterval(()=>setCountDown(o),1e3);eventsList.append(o),e.value="",t.value="",toggleHidden(eventsAddbtn),toggleHidden(eventsCreator),localStorage.setItem("eventList",eventsList.innerHTML)}function setCountDown(e){let t=e.querySelector(".events__item__countdown"),o=new Date,n=new Date(e.dataset.date);if(n>o){o=Math.floor((n-o)/1e3);let e=o%60;o=Math.floor(o/60);let l=o%60;o=Math.floor(o/60);let c=o%24;o=Math.floor(o/24),t.textContent="До события:  "+o+" Дней "+c+" Часов "+l+" минут "+e+" секунд"}else t.textContent="Завершено",t.style.color="red"}events.addEventListener("click",(function(e){let t=e.target;if((t.closest(".events__creator__newbtn")||t.closest(".events__cancel-btn"))&&(toggleHidden(eventsAddbtn),toggleHidden(eventsCreator)),t.closest(".events__save-btn")){const e=document.querySelector(".events__creator__title"),t=document.querySelector(".events__creator__date");e.value&&t.value?createNote(e,t):alert("Заполнены не все поля")}t.closest(".events__del-btn")&&(t.closest(".events__list__item").remove(),localStorage.setItem("eventList",eventsList.innerHTML))}));const scrollbtn=document.querySelector(".scroll-btn");document.addEventListener("scroll",(function(){const e=document.querySelector(".scroll-btn");window.pageYOffset>0?(e.classList.remove("hidden"),e.addEventListener("click",(function(){window.scrollTo({top:0,behavior:"smooth"})}))):e.classList.add("hidden")}));const timeSelect=document.querySelector(".clock__timezoes"),timeOutput=document.querySelector(".time-output"),loader=document.querySelector(".loader");async function getTimeZones(){try{let e=await fetch("https://worldtimeapi.org/api/timezone");if(e.ok){(await e.json()).map(e=>{let t=new Option(e,e);timeSelect.append(t)})}}catch(e){timeSelect.remove()}}async function getTime(){let e="";e=timeSelect.value?"https://worldtimeapi.org/api/"+timeSelect.value:"https://worldtimeapi.org/api/ip";try{let t=await fetch(e);if(t.ok){let e=await t.json(),o=new Date(e.datetime).toLocaleString("ru-Ru",{timeZone:e.timezone,hour:"numeric",minute:"numeric"});timeOutput.textContent=o,console.log(o),console.log(e);setTimeout(getTime,3e4)}}catch(e){timeOutput.textContent=(new Date).toLocaleString("ru-Ru",{hour:"numeric",minute:"numeric"})}loader.style.display="none"}getTimeZones(),getTime(),timeSelect.addEventListener("change",(function(){loader.style.display="block",getTime()}));