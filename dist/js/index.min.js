let todos=[],notesData=[];const modalContainer=document.querySelector(".modal__container"),todoContainer=document.querySelector(".todo__container"),addButton=document.querySelector(".todo__addBtn"),addModal=document.querySelector(".modal__add"),addModalCancel=document.querySelector(".modal__cancel__addbtn"),addItemBtn=document.querySelector(".modal__add__addbtn"),eventCheckbox=document.querySelector(".modal__add__checkbox-input"),todoDateInput=document.querySelector(".modal__add__date"),deleteModal=document.querySelector(".modal__delete"),delCancelBtn=document.querySelector(".modal__delete__cancelbtn"),todoBlocks=document.querySelectorAll(".todo__block"),editModal=document.querySelector(".modal__edit"),aboutBtn=document.querySelector(".about__btn"),aboutModal=document.querySelector(".modal__about"),aboutCloseBtn=document.querySelector(".modal__about__closeBtn"),instructionBtn=document.querySelector(".instruction__btn"),instructionModal=document.querySelector(".modal__instruction"),instructionCloseBtn=document.querySelector(".modal__instruction__closeBtn"),burgerMenu=document.querySelector(".burgermenu"),navMenu=document.querySelector(".header_nav_list"),header=document.querySelector(".header"),searchBtn=document.querySelector(".todo__searchbutton"),notesList=document.querySelector(".notes__list"),renderNote=()=>{notesList.innerHTML="",notesData.forEach(t=>{const e=document.createElement("li");e.id=t.id,e.classList.add("notes__list__item"),e.innerHTML=`<h3 class="notes__item__title">${t.title?t.title:"Заметка"}</h3>\n    <p class="notes__item__text">${t.body}</p>\n    <button class="notes__del-btn"></button>\n    `,notesList.append(e)})},showModal=t=>{modalContainer.classList.toggle("hidden"),t.classList.toggle("hidden")},toggleHidden=t=>{t.classList.toggle("hidden")},renderTodo=()=>{const t={mainBlock:document.querySelector(".todo__main__content"),inprogressBlock:document.querySelector(".todo__inprogress__content"),doneBlock:document.querySelector(".todo__done__content"),trashBlock:document.querySelector(".todo__trash__content")};Object.values(t).forEach(t=>{t.innerHTML=""}),todos.forEach(e=>{const o=document.createElement("div");o.id=e.id,o.draggable=!0,o.classList.add("todo__item"),o.innerHTML=`<h4 class="todo__item__header">${e.title}</h4>\n    <div class="todo__item__buttons">\n        <button class="inprogress__button" title="В процессе"></button>\n        <button class="delete__button" title="Удалить"></button>\n        <button class="inmain__button" title="В невыполненные"></button>\n        <button class="indone__button" title="В выполненные"></button>\n    </div>\n    <p class="todo__item__description">${e.description}</p>\n    <p class="todo__item__date">${e.currentDate}</p>\n    <button class="item__show"><span>Показать</span></button>`,t[e.block].append(o)})},counters=()=>{todoBlocks.forEach(t=>{const e=t.querySelector(".todo__counter"),o=t.querySelector(".todo__content");e.textContent=o.children.length.toString()})},addItem=()=>{const t=document.querySelector(".todo__title__input"),e=document.querySelector(".todo__comment__input"),o=new Date,n=o.getDate()+"."+(o.getMonth()+1)+"."+o.getFullYear(),c=new Todo(n,t.value,e.value,"mainBlock");if(todos.push(c),renderTodo(),eventCheckbox.checked){if(!t.value||!todoDateInput.value)return void alert("Чтобы добавить задачу в событие введите название и выберите дату");createNote(t,todoDateInput)}showModal(addModal),t.value="",e.value="",localStorage.setItem("todos",JSON.stringify(todos)),counters()},changeBlock=(t,e)=>{const o=t.closest(".todo__item");todos=todos.map(t=>(t.id===o.id&&(t.block=e),t)),o.remove(),console.log(todos),renderTodo(),localStorage.setItem("todos",JSON.stringify(todos)),counters()},uid=()=>Date.now().toString(36)+Math.random().toString(36).substr(2);localStorage.getItem("todos")&&(todos=JSON.parse(localStorage.getItem("todos")),renderTodo(),counters()),localStorage.getItem("noteList")&&(notesData=JSON.parse(localStorage.getItem("noteList")),renderNote());const eventsList=document.querySelector(".events__list");if(localStorage.getItem("eventList")){eventsList.innerHTML=localStorage.getItem("eventList");let t=document.querySelectorAll(".events__list__item");t.forEach(t=>{setCountDown(t);setInterval(()=>setCountDown(t),1e3)})}addButton.addEventListener("click",()=>showModal(addModal)),addModalCancel.addEventListener("click",()=>showModal(addModal)),addItemBtn.addEventListener("click",addItem);class Todo{constructor(t,e,o,n="mainBlock"){this.title=e,this.description=o,this.currentDate=t,this.block=n,this.id=uid()}}delCancelBtn.addEventListener("click",()=>showModal(deleteModal)),todoContainer.addEventListener("click",t=>{if(t.target.classList.contains("inprogress__button"))changeBlock(t.target,"inprogressBlock");else if(t.target.classList.contains("inmain__button"))changeBlock(t.target,"mainBlock");else if(t.target.classList.contains("indone__button"))changeBlock(t.target,"doneBlock");else if(t.target.classList.contains("delete__button"))if(t.target.closest(".todo__item").parentElement.classList.contains("todo__trash__content")){showModal(deleteModal);document.querySelector(".modal__delete__deletebtn").onclick=()=>{const e=t.target.closest(".todo__item").id;todos=todos.filter(t=>t.id!==e),renderTodo(),localStorage.setItem("todos",JSON.stringify(todos)),counters(),showModal(deleteModal)}}else changeBlock(t.target,"trashBlock");else if(t.target.classList.contains("todo__clear")){const e=t.target.closest(".todo__block").id;todos=todos.filter(t=>t.block!==e),renderTodo(),localStorage.setItem("todos",JSON.stringify(todos)),counters()}}),todoBlocks.forEach(t=>{t.addEventListener("dragstart",t=>{t.target.classList.add("dragnow")}),t.addEventListener("dragend",t=>{t.target.classList.remove("dragnow")}),t.addEventListener("dragover",t=>{t.preventDefault()}),t.addEventListener("drop",e=>{e.preventDefault();const o=document.querySelector(".dragnow");todos=todos.map(e=>(e.id===o.id&&(e.block=t.id),e)),renderTodo(),localStorage.setItem("todos",JSON.stringify(todos)),counters()})}),todoContainer.addEventListener("click",(function(t){if(t.target.classList.contains("item__show")){const e=t.target.closest(".todo__item").querySelector(".todo__item__header").textContent,o=t.target.closest(".todo__item").querySelector(".todo__item__description").textContent;editModal.innerHTML=`\n    <h2>${e}</h2>\n            <p>${o}</p>\n            <div class="modal__edit__buttons">\n                <button type="button" class="modal__edit__editbtn">Редактировать</button>\n                <button type="button" class="modal__cancel__editbtn">Закрыть</button>\n            </div>\n    `;document.querySelector(".modal__cancel__editbtn").addEventListener("click",()=>showModal(editModal));document.querySelector(".modal__edit__editbtn").onclick=()=>{editModal.innerHTML=`\n        <label for="edit__header">Название</label>\n    <input type="text" value="${e}" id="edit__header">\n    <label for="edit__comment">Описание</label>\n            <textarea id="edit__comment">${o}</textarea>\n            <div class="modal__edit__buttons">\n                <button type="button" class="modal__save__editbtn">Сохранить</button>\n                <button type="button" class="modal__cancel__editbtn">Закрыть</button>\n            </div>\n    `;document.querySelector(".modal__cancel__editbtn").addEventListener("click",()=>showModal(editModal));const n=document.getElementById("edit__header"),c=document.getElementById("edit__comment");document.querySelector(".modal__save__editbtn").addEventListener("click",()=>{const e=t.target.closest(".todo__item").id;todos=todos.map(t=>(t.id===e&&(t.title=n.value,t.description=c.value),t)),renderTodo(),localStorage.setItem("todos",JSON.stringify(todos)),showModal(editModal)})},showModal(editModal)}})),aboutBtn.addEventListener("click",()=>showModal(aboutModal)),aboutCloseBtn.addEventListener("click",()=>showModal(aboutModal)),instructionBtn.addEventListener("click",()=>showModal(instructionModal)),instructionCloseBtn.addEventListener("click",()=>showModal(instructionModal)),header.addEventListener("click",t=>{(t.target.closest(".burgermenu")||t.target.closest(".header_nav_list_item"))&&(burgerMenu.classList.toggle("active"),navMenu.classList.toggle("active"),header.classList.toggle("active"))}),searchBtn.onclick=()=>{const t=document.querySelector(".todo__searchInput"),e=document.querySelector(".modal__search"),o=document.querySelectorAll(".todo__item"),n=e.innerHTML,c=Array.from(o).filter(e=>e.querySelector(".todo__item__header").textContent.toLocaleLowerCase()===t.value.toLocaleLowerCase()).map(t=>{const e=t.cloneNode(!0);return e.querySelectorAll("button").forEach(t=>t.remove()),e});c.length>0?(showModal(e),e.append(...c)):alert("Ничего не найдено");document.querySelector(".modal__search__closeBtn").onclick=()=>{e.innerHTML=n,showModal(e)}};const calcButtons=document.querySelector(".calc__buttons"),calcScreen=document.querySelector(".calc__input"),calcOutput=document.querySelector(".calc__output"),modalCalc=document.querySelector(".modal__calc");document.addEventListener("click",t=>{t.target.closest(".calc__open")&&showModal(modalCalc),t.target.closest(".modal__calc__closeBtn")&&showModal(modalCalc)}),calcButtons.addEventListener("click",e=>{const targetEl=e.target;if(targetEl.closest(".calc__btn")&&(calcScreen.value+=targetEl.value,calcOutput.textContent+=targetEl.value),targetEl.closest(".calc__delall")&&(calcOutput.textContent=calcOutput.textContent.slice(0,-1),calcScreen.value=calcScreen.value.slice(0,-1)),targetEl.closest(".calc__del")&&(calcScreen.value="",calcOutput.textContent=""),targetEl.closest(".calc__funcbtn")){const t=Array.from(document.querySelectorAll(".calc__funcbtn")).map(t=>t.value);let e=calcOutput.textContent[calcOutput.textContent.length-1];if(console.log(t.includes(e)),t.includes(e))calcOutput.textContent=calcOutput.textContent.slice(0,-1),calcOutput.textContent+=targetEl.value,calcScreen.value="";else{if(""==calcOutput.textContent)return;calcOutput.textContent+=targetEl.value,calcScreen.value=""}}if(targetEl.closest(".calc__ebtn")){const calcResult=calcOutput.textContent.replace("%","/100*");calcScreen.value.includes(".")?calcScreen.value=eval(calcResult).toFixed(5):calcScreen.value=eval(calcResult),calcOutput.textContent=calcScreen.value}});const notes=document.querySelector(".notes"),notesAddBtn=document.querySelector(".notes__creator__newbtn"),notesCreator=document.querySelector(".notes__creator__body"),modalEditor=document.querySelector(".modal__notes-editor");class Note{constructor(t,e){this.title=t,this.body=e,this.id=uid()}}notes.addEventListener("click",t=>{const e=t.target;if((e.closest(".notes__creator__newbtn")||e.closest(".creator__cancel-btn"))&&(toggleHidden(notesAddBtn),toggleHidden(notesCreator)),e.closest(".creator__save-btn")){const t=document.querySelector(".creator__body__title"),e=document.querySelector(".creator__body__text"),o=new Note(t.value,e.value);notesData.push(o),renderNote(),t.value="",e.value="",toggleHidden(notesAddBtn),toggleHidden(notesCreator),localStorage.setItem("noteList",JSON.stringify(notesData))}if(e.closest(".notes__del-btn")){const t=e.closest(".notes__list__item").id;notesData=notesData.filter(e=>e.id!==t),renderNote(),localStorage.setItem("noteList",JSON.stringify(notesData))}if(e.closest(".notes__list__item")&&!e.closest(".notes__del-btn")){const t=e.closest(".notes__list__item"),o=document.querySelector(".notes-editor__title"),n=document.querySelector(".notes__editor__text"),c=document.querySelector(".notes-editor__savebtn"),l=document.querySelector(".notes-editor__cancelbtn");o.value=t.querySelector(".notes__item__title").textContent,n.value=t.querySelector(".notes__item__text").textContent,showModal(modalEditor),c.onclick=()=>{notesData=notesData.map(e=>(e.id===t.id&&(e.title=o.value,e.body=n.value),e)),renderNote(),localStorage.setItem("noteList",JSON.stringify(notesData)),showModal(modalEditor)},l.onclick=function(){showModal(modalEditor)}}});const events=document.querySelector(".events"),eventsAddbtn=document.querySelector(".events__creator__newbtn"),eventsCreator=document.querySelector(".events__creator__body"),dateOptions={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"};function createNote(t,e){let o=document.createElement("li");o.classList.add("events__list__item"),o.setAttribute("data-date",new Date(e.value)),o.innerHTML=`<h3 class="events__item__title">${t.value}</h3>\n  <p class="events__item__text">${new Date(e.value).toLocaleDateString("ru-RU",dateOptions)}</p>\n  <p class="events__item__countdown"></p>\n  <button class="events__del-btn"></button>`,setCountDown(o);setInterval(()=>setCountDown(o),1e3);eventsList.append(o),t.value="",e.value="",toggleHidden(eventsAddbtn),toggleHidden(eventsCreator),localStorage.setItem("eventList",eventsList.innerHTML)}function setCountDown(t){let e=t.querySelector(".events__item__countdown"),o=new Date,n=new Date(t.dataset.date);if(n>o){o=Math.floor((n-o)/1e3);let t=o%60;o=Math.floor(o/60);let c=o%60;o=Math.floor(o/60);let l=o%24;o=Math.floor(o/24),e.textContent="До события:  "+o+" Дней "+l+" Часов "+c+" минут "+t+" секунд"}else e.textContent="Завершено",e.style.color="red"}events.addEventListener("click",(function(t){let e=t.target;if((e.closest(".events__creator__newbtn")||e.closest(".events__cancel-btn"))&&(toggleHidden(eventsAddbtn),toggleHidden(eventsCreator)),e.closest(".events__save-btn")){const t=document.querySelector(".events__creator__title"),e=document.querySelector(".events__creator__date");t.value&&e.value?createNote(t,e):alert("Заполнены не все поля")}e.closest(".events__del-btn")&&(e.closest(".events__list__item").remove(),localStorage.setItem("eventList",eventsList.innerHTML))})),document.addEventListener("scroll",(function(){const t=document.querySelector(".scroll-btn");window.pageYOffset>0?(t.classList.remove("hidden"),t.addEventListener("click",(function(){window.scrollTo({top:0,behavior:"smooth"})}))):t.classList.add("hidden")}));const timeSelect=document.querySelector(".clock__timezoes"),timeOutput=document.querySelector(".time-output"),loader=document.querySelector(".loader");async function getTimeZones(){try{let t=await fetch("https://worldtimeapi.org/api/timezone");if(t.ok){(await t.json()).map(t=>{let e=new Option(t,t);timeSelect.append(e)})}}catch(t){timeSelect.remove()}}async function getTime(){let t="";t=timeSelect.value?"https://worldtimeapi.org/api/"+timeSelect.value:"https://worldtimeapi.org/api/ip";try{let e=await fetch(t);if(e.ok){let t=await e.json(),o=new Date(t.datetime).toLocaleString("ru-Ru",{timeZone:t.timezone,hour:"numeric",minute:"numeric"});timeOutput.textContent=o,console.log(o),console.log(t);setTimeout(getTime,3e4)}}catch(t){timeOutput.textContent=(new Date).toLocaleString("ru-Ru",{hour:"numeric",minute:"numeric"})}loader.style.display="none"}getTimeZones(),getTime(),timeSelect.addEventListener("change",(function(){loader.style.display="block",getTime()}));